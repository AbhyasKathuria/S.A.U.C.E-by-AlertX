<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>S.A.U.C.E Primary Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"/>
  <style>
    #map { height: 400px; }
    .status-badge { padding: 6px 14px; border-radius: 9999px; font-weight: 500; }
    .safe { background-color: rgba(16, 185, 129, 0.2); color: #10b981; border: 1px solid rgba(16,185,129,0.4); }
    .panic { background-color: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid rgba(239,68,68,0.4); }
  </style>
</head>
<body class="bg-slate-900 text-white min-h-screen flex flex-col">

  <!-- Main Container -->
  <main class="flex-grow p-6">
    <h1 class="text-3xl font-semibold">üë§ Primary User Dashboard</h1>
    <p class="mt-1 text-slate-400">Real-time status and location monitoring</p>

    <!-- Status -->
    <div class="mt-4">
      <span id="status" class="status-badge safe">Status: SAFE</span>
    </div>

    <!-- Map Section -->
    <div class="mt-6 card rounded-xl overflow-hidden shadow-lg border border-slate-700">
      <div class="bg-slate-800 px-4 py-2 border-b border-slate-700">
        <h2 class="text-lg font-medium">üìç Live Location</h2>
      </div>
      <div id="map"></div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-slate-800 text-slate-400 text-center text-sm py-4 border-t border-slate-700">
    ¬© 2025 S.A.U.C.E ‚Äî Send Assistance Upon Critical Emergencies ‚Ä¢ Team AlertX
  </footer>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script>
    let map = L.map('map').setView([20.59, 78.96], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    let marker;
    let username = "PrimaryUser";

    function updateLocation(lat, lng, status) {
      const statusEl = document.getElementById("status");
      statusEl.textContent = "Status: " + status.toUpperCase();

      // Style status badge
      statusEl.classList.remove("safe", "panic");
      if (status.toLowerCase() === "panic") {
        statusEl.classList.add("panic");
      } else {
        statusEl.classList.add("safe");
      }

      if (!marker) marker = L.marker([lat, lng]).addTo(map);
      marker.setLatLng([lat, lng]).bindPopup(status).openPopup();
      map.setView([lat, lng], 14);
    }

    async function checkPrimary() {
      let res = await fetch("http://localhost:3000/users");
      let data = await res.json();
      let me = data.users.find(u => u.username === username);
      if (me) updateLocation(me.lat, me.lng, me.status);
    }

    setInterval(checkPrimary, 3000);
  </script>
</body>
</html>
